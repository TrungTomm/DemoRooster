var t,e;t=void 0,e=function(){class t{constructor(t){this.scene=t}static register(e,r){t.prototype[e]=r}}function e(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var r={exports:{}};!function(t){var e=Object.prototype.hasOwnProperty,r="~";function s(){}function n(t,e,r){this.fn=t,this.context=e,this.once=r||!1}function i(t,e,s,i,o){if("function"!=typeof s)throw new TypeError("The listener must be a function");var h=new n(s,i||t,o),a=r?r+e:e;return t._events[a]?t._events[a].fn?t._events[a]=[t._events[a],h]:t._events[a].push(h):(t._events[a]=h,t._eventsCount++),t}function o(t,e){0==--t._eventsCount?t._events=new s:delete t._events[e]}function h(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(r=!1)),h.prototype.eventNames=function(){var t,s,n=[];if(0===this._eventsCount)return n;for(s in t=this._events)e.call(t,s)&&n.push(r?s.slice(1):s);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},h.prototype.listeners=function(t){var e=r?r+t:t,s=this._events[e];if(!s)return[];if(s.fn)return[s.fn];for(var n=0,i=s.length,o=new Array(i);n<i;n++)o[n]=s[n].fn;return o},h.prototype.listenerCount=function(t){var e=r?r+t:t,s=this._events[e];return s?s.fn?1:s.length:0},h.prototype.emit=function(t,e,s,n,i,o){var h=r?r+t:t;if(!this._events[h])return!1;var a,u,v=this._events[h],c=arguments.length;if(v.fn){switch(v.once&&this.removeListener(t,v.fn,void 0,!0),c){case 1:return v.fn.call(v.context),!0;case 2:return v.fn.call(v.context,e),!0;case 3:return v.fn.call(v.context,e,s),!0;case 4:return v.fn.call(v.context,e,s,n),!0;case 5:return v.fn.call(v.context,e,s,n,i),!0;case 6:return v.fn.call(v.context,e,s,n,i,o),!0}for(u=1,a=new Array(c-1);u<c;u++)a[u-1]=arguments[u];v.fn.apply(v.context,a)}else{var f,p=v.length;for(u=0;u<p;u++)switch(v[u].once&&this.removeListener(t,v[u].fn,void 0,!0),c){case 1:v[u].fn.call(v[u].context);break;case 2:v[u].fn.call(v[u].context,e);break;case 3:v[u].fn.call(v[u].context,e,s);break;case 4:v[u].fn.call(v[u].context,e,s,n);break;default:if(!a)for(f=1,a=new Array(c-1);f<c;f++)a[f-1]=arguments[f];v[u].fn.apply(v[u].context,a)}}return!0},h.prototype.on=function(t,e,r){return i(this,t,e,r,!1)},h.prototype.once=function(t,e,r){return i(this,t,e,r,!0)},h.prototype.removeListener=function(t,e,s,n){var i=r?r+t:t;if(!this._events[i])return this;if(!e)return o(this,i),this;var h=this._events[i];if(h.fn)h.fn!==e||n&&!h.once||s&&h.context!==s||o(this,i);else{for(var a=0,u=[],v=h.length;a<v;a++)(h[a].fn!==e||n&&!h[a].once||s&&h[a].context!==s)&&u.push(h[a]);u.length?this._events[i]=1===u.length?u[0]:u:o(this,i)}return this},h.prototype.removeAllListeners=function(t){var e;return t?(e=r?r+t:t,this._events[e]&&o(this,e)):(this._events=new s,this._eventsCount=0),this},h.prototype.off=h.prototype.removeListener,h.prototype.addListener=h.prototype.on,h.prefixed=r,h.EventEmitter=h,t.exports=h}(r);var s=e(r.exports);class n extends s{shutdown(){this.removeAllListeners()}destroy(){this.removeAllListeners()}}var i=function(t,e,r){if(!t||"number"==typeof t)return r;if("string"==typeof e){if(t.hasOwnProperty(e))return t[e];if(-1===e.indexOf("."))return r;e=e.split(".")}for(var s=e,n=t,i=r,o=0;o<s.length;o++){if(e=s[o],!n.hasOwnProperty(e)){i=r;break}n=i=n[e]}return i},o=new class{constructor(t){this.nextId=i(t,"start",1),this.uidKey=i(t,"uidKey","$uid"),this.autoRemove=i(t,"remove",!0),this.refs={},this.count=0}add(t,e){var r=this.refs,s=this.uidKey;if(s&&null!=(e=t[s]))return this;if(null==e)do{e=this.nextId,this.nextId++}while(r.hasOwnProperty(e));return r.hasOwnProperty(e)?e=null:(r[e]=t,this.count++,s&&(t[s]=e),this.autoRemove&&t.on&&t.once("destroy",(function(){this.remove(e)}),this)),s?this:e}addMultiple(t){for(var e=0,r=t.length;e<r;e++)this.add(t[e]);return this}get(t){return this.refs[t]}has(t){return this.refs.hasOwnProperty(t)}remove(t){var e=this.refs;return e.hasOwnProperty(t)&&(this.uidKey&&(e[t][this.uidKey]=void 0),delete e[t],this.count--),this}forEach(t,e){var r,s=this.refs;for(var n in s)r=s[n],e?t.call(e,r,n):t(r,n)}clear(){this.forEach((function(t){this.remove(t)}),this)}}({uidKey:"$uid",remove:!1}),h={setEventEmitter(t,e){return void 0===e&&(e=Phaser.Events.EventEmitter),this._privateEE=!0===t||void 0===t,this._eventEmitter=this._privateEE?new e:t,this},destroyEventEmitter(){return this._eventEmitter&&this._privateEE&&this._eventEmitter.shutdown(),this},getEventEmitter(){return this._eventEmitter},on(){return this._eventEmitter&&this._eventEmitter.on.apply(this._eventEmitter,arguments),this},once(){return this._eventEmitter&&this._eventEmitter.once.apply(this._eventEmitter,arguments),this},off(){return this._eventEmitter&&this._eventEmitter.off.apply(this._eventEmitter,arguments),this},emit(t){return this._eventEmitter&&t&&this._eventEmitter.emit.apply(this._eventEmitter,arguments),this},addListener(){return this._eventEmitter&&this._eventEmitter.addListener.apply(this._eventEmitter,arguments),this},removeListener(){return this._eventEmitter&&this._eventEmitter.removeListener.apply(this._eventEmitter,arguments),this},removeAllListeners(){return this._eventEmitter&&this._eventEmitter.removeAllListeners.apply(this._eventEmitter,arguments),this},listenerCount(){return this._eventEmitter?this._eventEmitter.listenerCount.apply(this._eventEmitter,arguments):0},listeners(){return this._eventEmitter?this._eventEmitter.listeners.apply(this._eventEmitter,arguments):[]},eventNames(){return this._eventEmitter?this._eventEmitter.eventNames.apply(this._eventEmitter,arguments):[]}};const a=Phaser.Scene;var u=function(t){return t instanceof a};const v=Phaser.Game;var c=function(t){return t instanceof v};const f=Phaser.Utils.Objects.GetValue;class p{constructor(t,e){this.setParent(t),this.isShutdown=!1,this.setEventEmitter(f(e,"eventEmitter",!0)),this.parent&&(this.parent===this.scene?this.scene.sys.events.once("shutdown",this.onEnvDestroy,this):this.parent===this.game?this.game.events.once("shutdown",this.onEnvDestroy,this):this.parent.once&&this.parent.once("destroy",this.onParentDestroy,this))}shutdown(t){this.isShutdown||(this.parent&&(this.parent===this.scene?this.scene.sys.events.off("shutdown",this.onEnvDestroy,this):this.parent===this.game?this.game.events.off("shutdown",this.onEnvDestroy,this):this.parent.once&&this.parent.off("destroy",this.onParentDestroy,this)),this.destroyEventEmitter(),this.parent=void 0,this.scene=void 0,this.game=void 0,this.isShutdown=!0)}destroy(t){this.shutdown(t)}onEnvDestroy(){this.destroy(!0)}onParentDestroy(t,e){this.destroy(e)}setParent(t){var e;return this.parent=t,this.scene=null==(e=t)||"object"!=typeof e?null:u(e)?e:e.scene&&u(e.scene)?e.scene:e.parent&&e.parent.scene&&u(e.parent.scene)?e.parent.scene:null,this.game=function(t){return null==t||"object"!=typeof t?null:c(t)?t:c(t.game)?t.game:u(t)?t.sys.game:u(t.scene)?t.scene.sys.game:void 0}(t),this}}Object.assign(p.prototype,h);const d=o.uidKey;class l extends p{constructor(t,e){super(t,{eventEmitter:!1}),o.add(this,e),this.graph=null,this.type=void 0}shutdown(t){this.isShutdown||(this.graph&&this.graph.remove(this[d]),o.remove(this[d]),this.setGraph(null),super.shutdown(t))}setGraph(t){return this.graph=t,t||this.setType(void 0),this}setType(t){return"string"==typeof t&&(t=g[t]),this.type=t,this}get isVertex(){return!!this.graph&&0===this.type}get isEdge(){return!!this.graph&&1===this.type}}Object.assign(l.prototype,{});const g={vertex:0,edge:1};var y=function(t){var e=typeof t;return"number"===e||"string"===e},m=function(t){return y(t)?o.get(t):(t.hasOwnProperty("rexGraphItem")||(t.rexGraphItem=new l(t)),t.rexGraphItem)};const E={"->":1,"<-":2,"<->":3};var x=function(t){return null==t?null:o.get(t).parent};const _={"breadth-first":0,bfs:0,"depth-first":1,dfs:1};var w={getEdgeData:function(t,e){void 0===e&&(e=!1);var r=this.getObjUID(t);return e&&!this.edges.hasOwnProperty(r)&&(this.edges[r]={}),this.edges[r]},isEdge:function(t){var e=this.getObjUID(t);return this.edges.hasOwnProperty(e)},addEdge:function(t,e,r,s){if(this.isEdge(t))return this;void 0===s&&(s=3);var n=this.getObjUID(t),i=this.getEdgeData(n,!0);i.dir=s,i.vA=this.getObjUID(e),i.vB=this.getObjUID(r),m(t).setGraph(this),this.edgeCount++,this.addVertex(e).addVertex(r);var o=this.getVertexData(e,!0),h=this.getVertexData(r,!0);return"string"==typeof s&&(s=E(s)),1&s&&(o[n]=i.vB),2&s&&(h[n]=i.vA),this},removeEdge:function(t,e){if(this.isEdge(t))return this;void 0===e&&(e=!1);var r=this.getObjUID(t);return delete this.edges[r],this.edgeCount--,m(t).setGraph(null),e&&t.destroy&&gameObject.destroy(),this},getAllEdges:function(t){var e;for(var r in void 0===t&&(t=[]),this.edges)(e=x(r))&&t.push(e);return t},getEdgesOfVertex:function(t,e){void 0===e&&(e=[]);var r,s=this.getVertexData(t);if(!s)return e;for(var n in s)(r=x(n))&&e.push(r);return e},getEdgeLength:function(t){var e=this.getEdgeData(t);if(!e)return 0;var r,s,n,i,o,h,a=x(e.vA),u=x(e.vB);return a&&u?(r=a.x,s=a.y,n=u.x,i=u.y,o=r-n,h=s-i,Math.sqrt(o*o+h*h)):0},isInLoop:function(t){if(!this.isVertex(t))return!1;for(var e,r,s,n,i,o=this.getObjUID(t),h=[[o,null]],a={};h.length>0;){if(r=(e=h.pop())[0],s=e[1],r===o&&null!==s)return!0;for(s in null!==s&&(a[s]=!0),n=this.getVertexData(r))a.hasOwnProperty(s)||(i=n[s],h.push([i,s]))}return!1},getVertexData:function(t,e){void 0===e&&(e=!1);var r=this.getObjUID(t);return e&&!this.vertices.hasOwnProperty(r)&&(this.vertices[r]={}),this.vertices[r]},isVertex:function(t){var e=this.getObjUID(t);return this.vertices.hasOwnProperty(e)},addVertex:function(t){return this.isVertex(t)||(this.getVertexData(t,!0),m(t).setGraph(this),this.vertexCount++),this},addVertices:function(t){for(var e=0,r=t.length;e<r;e++)this.addVertex(t[e]);return this},removeVertex:function(t,e,r){if(!this.isVertex(t))return this;void 0===e&&(e=!1),void 0===r&&(r=!0);var s=this.getObjUID(t);if(r){var n=this.getVertexData(s);for(var i in n)this.removeEdge(i,e)}return delete this.vertices[s],this.vertexCount--,m(t).setGraph(null),e&&t.destroy&&gameObject.destroy(),this},removeAllVertices:function(t){for(var e in this.vertices)this.removeVertex(e,t);return this},getAllVertices:function(t){var e;for(var r in void 0===t&&(t=[]),this.vertices)(e=x(r))&&t.push(e);return t},getVerticesOfEdge:function(t,e){void 0===e&&(e=[]);var r,s=this.getEdgeData(t);return s?((r=x(s.vA))&&e.push(r),(r=x(s.vB))&&e.push(r),e):e},getOppositeVertex:function(t,e){var r=this.getVertexData(t);if(r){var s=this.getObjUID(e);if(s)return x(r[s])}},getAllConnectedVertices:function(t,e,r){if(void 0===e&&(e=[]),"string"==typeof r&&(r=_[r]),void 0===r&&(r=0),!this.isVertex(t))return e;for(var s,n,i=this.getObjUID(t),o=0===r,h=[i],a={};h.length>0;)if(s=o?h.shift():h.pop(),!a.hasOwnProperty(s))for(var u in a[s]=!0,s!==i&&e.push(x(s)),this.getVertexData(s))n=this.getOppositeVertex(s,u),a.hasOwnProperty(n)||h.push(n);return e},getNeighborVertices:function(t,e){void 0===e&&(e=[]);var r,s=this.getVertexData(t);if(s)for(var n in s)(r=x(s[n]))&&e.push(r);return e},areNeighborVertices:function(t,e){var r=this.getObjUID(t),s=this.getObjUID(e);if(null!=r&&null!=s){var n=this.getVertexData(t);for(var i in s=parseInt(s),n)if(n[i]===s)return!0}return!1}};const b=o.uidKey;class O extends n{constructor(t){super(),this.isShutdown=!1,this.scene=t,this.vertices={},this.edges={},this.vertexCount=0,this.edgeCount=0,this.boot()}boot(){this.scene&&this.scene.sys.events.once("shutdown",this.destroy,this)}shutdown(t){if(!this.isShutdown)return this.scene&&this.scene.sys.events.off("shutdown",this.destroy,this),this.clear(),super.shutdown(),this.scene=void 0,this.vertices=void 0,this.edges=void 0,this.vertexCount=0,this.edgeCount=0,this.isShutdown=!0,this}destroy(t){this.isShutdown||(this.emit("destroy"),this.shutdown(t))}exists(t){return this.isEdge(t)||this.isVertex(t)}remove(t){return this.isEdge(t)?this.removeEdge(t):this.isVertex(t)&&this.removeVertex(t),this}clear(t){return void 0===t&&(t=!0),this.removeAllVertices(t),this}getObjUID(t){return function(t){return y(t)?t:m(t)[b]}(t)}}Object.assign(O.prototype,w);var D=function(t){return null==t||""===t||0===t.length};t.register("graph",(function(t){return new O(this.scene,t)})),function(t,e,r,s){if(void 0===s&&(s="."),"object"==typeof t)if(D(e)){if(null==r)return;"object"==typeof r&&(t=r)}else{"string"==typeof e&&(e=e.split(s));var n=e.pop(),i=function(t,e,r){var s=t;if(D(e));else{var n;"string"==typeof e&&(e=e.split("."));for(var i=0,o=e.length;i<o;i++){var h;null!=s[n=e[i]]&&"object"==typeof s[n]||(h=i===o-1?void 0===r?{}:r:{},s[n]=h),s=s[n]}}return s}(t,e);i[n]=r}}(window,"RexPlugins.Graph.Graph",O);class V extends Phaser.Plugins.ScenePlugin{constructor(e,r){super(e,r),this.add=new t(e)}boot(){this.scene.sys.events.on("destroy",this.destroy,this)}destroy(){this.add.destroy(),super.destroy()}}return V},"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).rexgraphplugin=e();
